<link rel="import" href="../components/polymer/polymer.html">
<link rel="import" href="../components/context-free-parser/context-free-parser.html">
<link rel="import" href="../components/marked-element/marked-element.html">
<link rel="import" href="../components/highlightjs-element/highlightjs-element.html">


<polymer-element name="component-docs" attributes="elements">
  <template>
    <context-free-parser url="{{url}}" on-data-ready="{{dataReady}}"
      data="{{data}}"></context-free-parser>
    <template repeat="{{data.classes}}">
      <doc-page id="{{name}}" name="{{name}}" data="{{}}"></doc-page>
    </template>
  </template>
  <script>
    Polymer('component-docs', {
      elementName: null,
      url: null,
      elements: {},
      updateElementFromHash: function() {
        var elementName = window.location.hash.slice(1);
        if (this.elementName !== elementName && this.elements[elementName]) {
          this.elementName = elementName;
        }
      },
      ready: function() {
        this.updateElementFromHash();
        window.addEventListener('hashchange', this.updateElementFromHash.bind(this));
      },
      elementNameChanged: function() {
        this.url = '/' + this.elements[this.elementName];
        window.location.hash = this.elementName;
      },
      dataChanged: function() {
        if (this.data.classes[0].name === 'Entity') {
          this.data.classes[0].name = this.elementName;
        }
      }
    });
  </script>
</polymer-element>

<polymer-element name="doc-page" attributes="data" assetpath="../core-doc-viewer/elements/">
  <template>
  <link rel="stylesheet" href="../components/highlightjs/styles/default.css">
    <style>
    :host {
      display: block;
    }
    h1 {
      color: #E91E63;
      font-size: 52px;
      line-height: 60px;
      font-weight: normal;
    }
    .box {
      margin-bottom: 40px;
    }
    .top pre {
      padding: 12px 13px;
      background-color: #f8f8f8;
    }
    code {
      font-family: Consolas, monospace;
      border: 1px solid #ddd;
      background-color: #f8f8f8;
      border-radius: 3px;
      padding: 0 3px;
    }
    pre code {
      max-width: 832px;
      white-space: pre-wrap;
      overflow: hidden;
      border: none;
    }
    .details {
      display: flex;
    }
    .details-name {
      flex: 1;
    }
    .details-info {
      flex: 2;
    }
    .attribute-box .details {
      background-color: #FFF9C4;
      padding: 8px 16px;
      border-bottom: 1px solid #D1CCA1;
    }
    .attribute-box .ntitle {
      padding: 24px 16px;
    }
    code {
      border: none;
      background-color: transparent;
      border-radius: none;
      padding: 0;
    }
    .attribute-box code {
      color: #FFAB40;
    }
    .property-box .ntitle {
      padding: 24px 16px;
    }
    .property-box code {
      color: #4285F4;
    }
    .property-box .details {
      background-color: lightblue;
      padding: 8px 16px;
      border-bottom: 1px solid #D1CCA1;
    }
    .method-box .details {
      background-color: #F0F4C3;
      padding: 8px 16px;
      border-bottom: 1px solid #D1CCA1;
    }
    .method-box .ntitle {
      background-color: #9E9D24;
      padding: 24px 16px;
    }
    .method-box code {
      color: #9E9D24;
    }
    .event-box .details {
      background-color: #B2DFDB;
      padding: 8px 16px;
      border-bottom: 1px solid #92B7B3;
    }
    .event-box .ntitle {
      background-color: #009688;
      padding: 24px 16px;
    }
    .event-box code {
      color: #009688;
    }
    .badge {
      display: inline-block;
      border-radius: 3px;
      background-color: #009688;
      color: #fff;
      text-decoration: none;
      text-transform: uppercase;
      padding: 3px 5px;
    }
    </style>
    <div class="main" on-marked-js-highlight="{{hilight}}">
      <h1>{{data.name}}</h1>
      <p>
        <a class="badge" href="http://23.236.53.27/archive?{{data.name}}=Polymer/{{data.name}}">Download</a>
        <a class="badge" target="_blank" href="/components/{{data.name}}/demo.html">Demo</a>
        <a class="badge" target="_blank" href="http://github.com/Polymer/{{data.name}}">Source</a>
      </p>
      <template if="{{data.extends}}">
        <section class="box">
          <div class="ntitle">Extends</div>
          <p><a href="#{{data.extends}}">{{data.extends}}</a></p>
        </section>
      </template>
      <template if="{{data.description}}">
        <section class="box top">
          <div class="ntitle">Summary</div>
          <marked-element text="{{data.description}}"></marked-element>
        </section>
      </template>
      <template if="{{data.attributes.length}}">
        <section class="box attribute-box">
          <div class="ntitle" style="background-color: #FFAB40; color: white;">Attributes</div>
          <template repeat="{{data.attributes}}">
            <div class="details">
              <div class="details-name">
                <p><code>{{name}}</code></p>
              </div>
              <div class="details-info">
                <p><code>{{type}}</code></p>
                <marked-element text="{{description}}"></marked-element>
              </div>
            </div>
          </template>
        </section>
      </template>

      <template if="{{data.properties.length}}">
        <section class="box property-box">
          <div class="ntitle" style="background-color: #4285F4; color: white;">Properties</div>
          <template repeat="{{data.properties}}">
            <div class="details">
              <div class="details-name">
                <p><code>{{name}}</code></p>
              </div>
              <div class="details-info">
                <p><code>{{type}}</code></p>
                <marked-element text="{{description}}"></marked-element>
              </div>
            </div>
          </template>
        </section>
      </template>

      <template if="{{data.events.length}}">
        <section class="box event-box">
          <div class="ntitle" style="color: white;">Events</div>
          <template repeat="{{data.events}}">
            <div class="details">
              <div class="details-name">
                <p><code>{{name}}</code></p>
              </div>
              <div class="details-info">
                <marked-element text="{{description}}"></marked-element>
              </div>
            </div>
          </template>
        </section>
      </template>

      <template if="{{data.methods.length}}">
        <section class="box method-box">
          <div class="ntitle" style="color: white;">Methods</div>
          <template repeat="{{data.methods}}">
            <div class="details">
              <div class="details-name">
                <p><code>{{name}}</code></p>
              </div>
              <div class="details-info">
                <marked-element text="{{description}}"></marked-element>
              </div>
            </div>
          </template>
        </section>
      </template>

    </div>
  </template>
  <script>
    Polymer('doc-page', {
      hilight: function(event, detail, sender) {
        detail.code = hljs.highlightAuto(detail.code).value;
      }
    });
  </script>
</polymer-element>

